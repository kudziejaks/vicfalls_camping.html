<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VicFalls Summer Holiday Camping — Full App</title>
<style>
  :root{
    --card-bg: rgba(0,80,160,0.35);
    --accent: #2e9df7;
    --success: #2ecc71;
    --danger: #e74c3c;
    --warn: #f1c40f;
    --muted: #95a5a6;
    --glass: rgba(0,0,0,0.45);
    --text: #fff;
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:#001; color:var(--text);}
  body{
    background-image: url('https://images.unsplash.com/photo-1500375592092-40eb2168fd21?auto=format&fit=crop&w=1600&q=60');
    background-size: cover;
    background-position:center;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  .overlay{
    background: linear-gradient(180deg, rgba(0,0,0,0.4), rgba(0,0,0,0.55));
    min-height:100%;
    padding:32px 12px;
    box-sizing:border-box;
  }
  .container{
    max-width:980px;
    margin:0 auto;
    display:grid;
    grid-template-columns: 1fr 380px;
    gap:20px;
  }
  .card{
    background:var(--card-bg);
    border-radius:16px;
    padding:18px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    color:var(--text);
  }
  header.card{
    grid-column: 1 / -1;
    display:flex;
    align-items:center;
    gap:16px;
  }
  header h1{margin:0;font-size:20px}
  .small{font-size:13px; color: #e9f6ffcc}
  .left-col{min-height:200px}
  .right-col{position:sticky; top:24px; height:fit-content}
  input, select, textarea, button {
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:none;
    box-sizing:border-box;
    margin-top:8px;
    font-size:14px;
  }
  input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.7); }
  .muted{ color: var(--muted); font-size:13px }
  .btn{ background:var(--accent); color:white; cursor:pointer; }
  .btn-danger{ background:var(--danger); }
  .btn-ghost{ background: transparent; border:1px solid rgba(255,255,255,0.08); color:var(--text); }
  .feedback{ margin-top:8px; color: var(--success); font-weight:700; }
  .gallery img{ width:48%; margin:1%; border-radius:10px; display:inline-block; cursor:pointer; }
  .countdown{ font-size:16px; font-weight:700; color: gold; padding:6px 0;}
  .itinerary li{ margin:6px 0; }
  table{ width:100%; border-collapse:collapse; font-size:13px; }
  th,td{ padding:8px 6px; text-align:left; border-bottom: 1px dashed rgba(255,255,255,0.06); }
  tr.status-accept td{ background: rgba(46,204,113,0.06); }
  tr.status-deny td{ background: rgba(231,76,60,0.05); }
  tr.status-unsubmitted td{ background: rgba(200,200,200,0.02); }
  tr.status-notlogged td{ background: rgba(241,196,15,0.03); }
  .small-muted{ font-size:12px; color: #dbeeffaa; }
  .flex{ display:flex; gap:8px; align-items:center; }
  .center{ text-align:center; }
  @media (max-width:980px){
    .container{ grid-template-columns: 1fr; padding-bottom:60px; }
    header.card{ flex-direction:column; align-items:flex-start; gap:6px; }
    .right-col{ position:static; top:auto; }
    .gallery img{ width:48%; }
  }
</style>
</head>
<body>
<div class="overlay">
  <div class="container">

    <!-- Header -->
    <header class="card">
      <div style="flex:1;">
        <h1>VicFalls Summer Holiday Camping</h1>
        <div class="small">Event dates: <strong>December 19 → 26, 2025</strong></div>
      </div>

      <div style="width:260px;">
        <div class="small-muted">Admin login</div>
        <div style="display:flex;gap:6px">
          <input id="adminName" placeholder="Admin" value="Admin" />
          <input id="adminPass" type="password" placeholder="Password" />
          <button class="btn" onclick="adminLogin()">Login</button>
        </div>
        <div class="small muted" style="margin-top:6px">Admin creds: <strong>Admin / AdminPass2025</strong></div>
      </div>
    </header>

    <!-- LEFT: Participant / Main -->
    <section class="card left-col" id="mainCard">

      <!-- Login / Signup -->
      <div id="guestCard">
        <h2 style="margin:0">Participant login / Signup</h2>
        <p class="small">If you already have a name and password, enter it. Or sign up below.</p>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="fullname" placeholder="Full name (e.g. Godfrey Jakata)" />
          <input id="pwd" placeholder="Password (e.g. Chikomborero)" type="password" />
        </div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="btn" onclick="participantLogin()">Login</button>
          <button class="btn btn-ghost" onclick="showSignup()">Signup</button>
        </div>
        <p id="loginMsg" class="muted"></p>
      </div>

      <!-- Signup card -->
      <div id="signupCard" style="display:none;margin-top:12px;">
        <h3>Quick Signup</h3>
        <input id="su_name" placeholder="Full name" />
        <input id="su_email" placeholder="Email address" />
        <input id="su_phone" placeholder="Phone number" />
        <input id="su_pass" placeholder="Pick a password" />
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="btn" onclick="signup()">Create account</button>
          <button class="btn btn-ghost" onclick="hideSignup()">Cancel</button>
        </div>
        <p id="signupMsg" class="muted"></p>
      </div>

      <!-- Participant Dashboard -->
      <div id="participantCard" style="display:none;margin-top:12px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h2 id="welcomeName" style="margin:0">Welcome!</h2>
          <div class="small-muted">Local time: <span id="localTime"></span></div>
        </div>

        <div class="countdown" id="countdown">Loading countdown...</div>

        <h3>Quick profile</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <input id="userEmail" placeholder="Email" />
          <input id="userPhone" placeholder="Phone" />
        </div>
        <div class="muted small">Your contact info is stored in your browser and visible to admin for event coordination.</div>
        <button class="btn" style="margin-top:8px" onclick="saveProfile()">Save Profile</button>
        <p id="profileMsg" class="feedback"></p>

        <hr style="border:none;margin:12px 0;border-top:1px solid rgba(255,255,255,0.06)">

        <h3>Activities & RSVP</h3>
        <ul class="muted">
          <li>White water rafting — $50</li>
          <li>Helicopter tour — $150</li>
          <li>Chobe full day — $190</li>
          <li>Zambezi Sunset Cruise — $49</li>
          <li>Boma Dinner & Drum Show — $85</li>
        </ul>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
          <select id="rsvpChoice">
            <option value="Accepted">Accept Invite</option>
            <option value="Declined">Decline</option>
          </select>
          <select id="transportChoice">
            <option value="Own Transport">Own Transport</option>
            <option value="Group Transport">Group Transport</option>
          </select>
        </div>
        <select id="accommodationChoice" style="margin-top:8px;">
          <option value="Own Accommodation">Own Accommodation</option>
          <option value="Group Accommodation">Group Accommodation</option>
        </select>

        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="btn" onclick="submitRSVP()">Submit RSVP</button>
          <button class="btn btn-ghost" onclick="logout()">Logout</button>
        </div>
        <p id="rsvpMsg" class="feedback"></p>
      </div>
    </section>

    <!-- RIGHT: Admin -->
    <aside class="card right-col" id="adminCard" style="display:block;">
      <h3>Quick info</h3>
      <div class="small-muted">Event: Dec 19 → 26, 2025</div>
      <div style="height:10px"></div>

      <div style="margin-top:10px;">
        <h3>Admin Dashboard</h3>
        <div class="small-muted">After logging in you will see the full dashboard below.</div>

        <div id="adminPanel" style="display:none;margin-top:10px;">
          <div style="display:flex;gap:6px">
            <button class="btn" onclick="refreshAdminView()">Refresh</button>
          </div>

          <h4 style="margin-top:12px">Participants Overview</h4>
          <div style="max-height:260px; overflow:auto;">
            <table id="adminTable" role="table" aria-label="participants">
              <thead>
                <tr><th>Name</th><th>Email</th><th>Phone</th><th>Logged In</th><th>RSVP</th><th>Transport</th><th>Accommodation</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </aside>

  </div><!-- /container -->
</div><!-- /overlay -->

<!-- ======================= SCRIPT ======================= -->
<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
(function(){
  emailjs.init("yOwYpcXjeLqxfopJb"); // Public key
})();
</script>
<script>
/* -----------------------------
   Data model & persistence
----------------------------- */
const STORAGE_KEYS = {
  participants: "vicfalls_participants_v1",
  loginData: "vicfalls_login_v1"
};

const defaultParticipants = {
  "godfrey jakata": { displayName: "Godfrey Jakata", password: "Chikomborero" }
};

let participants = load(STORAGE_KEYS.participants) || defaultParticipants;
let loginData = load(STORAGE_KEYS.loginData) || {};

function save(key,obj){ localStorage.setItem(key,JSON.stringify(obj)); }
function load(key){ try{ const v=localStorage.getItem(key); return v?JSON.parse(v):null;}catch(e){return null;} }
function nowStr(){ return new Date().toLocaleString(); }

/* -----------------------------
   Signup & login
----------------------------- */
function showSignup(){ document.getElementById("signupCard").style.display="block"; document.getElementById("signupMsg").innerText=""; }
function hideSignup(){ document.getElementById("signupCard").style.display="none"; }

let currentUser = null;

function signup(){
  const name=document.getElementById("su_name").value.trim();
  const email=document.getElementById("su_email").value.trim();
  const phone=document.getElementById("su_phone").value.trim();
  const pass=document.getElementById("su_pass").value.trim();
  if(!name||!email||!phone||!pass){ document.getElementById("signupMsg").innerText="Please fill all fields"; return; }
  const key=name.toLowerCase();
  if(participants[key]){ document.getElementById("signupMsg").innerText="An account with that name already exists"; return; }
  participants[key]={displayName:name,password:pass,email,phone};
  save(STORAGE_KEYS.participants,participants);
  document.getElementById("signupMsg").innerText="Account created! You can now login.";
  setTimeout(()=>{ hideSignup(); document.getElementById("signupMsg").innerText=""; },1200);
}

function participantLogin(){
  const nameRaw=document.getElementById("fullname").value.trim();
  const pass=document.getElementById("pwd").value;
  if(!nameRaw){ document.getElementById("loginMsg").innerText="Please enter your name."; return; }
  const key=nameRaw.toLowerCase();
  if(!participants[key]){ document.getElementById("loginMsg").innerText="Name not found. Please sign up or check spelling."; return; }
  if(participants[key].password!==pass){ document.getElementById("loginMsg").innerText="Incorrect password. Check and try again."; return; }

  currentUser=key;
  if(!loginData[key]) loginData[key]={loginTime:nowStr(),RSVP:"Not yet submitted",transport:"-",accommodation:"-",email:participants[key].email,phone:participants[key].phone};
  else loginData[key].loginTime=nowStr();
  save(STORAGE_KEYS.loginData,loginData);
  document.getElementById("loginMsg").innerText="";
  showParticipantDashboard();
}

/* -----------------------------
   Dashboard
----------------------------- */
function showParticipantDashboard(){
  document.getElementById("guestCard").style.display="none";
  document.getElementById("signupCard").style.display="none";
  document.getElementById("participantCard").style.display="block";
  document.getElementById("welcomeName").innerText=participants[currentUser].displayName;
  document.getElementById("userEmail").value=loginData[currentUser].email;
  document.getElementById("userPhone").value=loginData[currentUser].phone;
}

/* -----------------------------
   RSVP + EmailJS
----------------------------- */
function submitRSVP(){
  if(!currentUser){ alert("Please login first."); return; }
  const rsvp=document.getElementById("rsvpChoice").value;
  const transport=document.getElementById("transportChoice").value;
  const accommodation=document.getElementById("accommodationChoice").value;
  loginData[currentUser].RSVP=rsvp;
  loginData[currentUser].transport=transport;
  loginData[currentUser].accommodation=accommodation;
  save(STORAGE_KEYS.loginData,loginData);
  document.getElementById("rsvpMsg").innerText=`RSVP "${rsvp}" recorded.`;

  if(rsvp==="Accepted"){
    // Send feedback email via EmailJS
    const templateParams = {
      name: participants[currentUser].displayName,
      email: participants[currentUser].email,
      rsvp: rsvp
    };
    emailjs.send('service_n6q8s1o','template_kobgbcc',templateParams)
    .then(function(response){
      console.log('Email sent',response.status,response.text);
    }, function(error){
      console.error('Email error',error);
    });
  }
  setTimeout(()=>{ document.getElementById("rsvpMsg").innerText=""; },2500);
}
</script>
</body>
</html>
